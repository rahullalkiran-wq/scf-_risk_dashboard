<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1.0"/>
<title>Vayana SCF Risk Intelligence | Aug 2025 â€“ Jan 2026</title>
<link rel="preconnect" href="https://fonts.googleapis.com"/>
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin/>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&family=JetBrains+Mono:wght@400;500;600;700;800&display=swap" rel="stylesheet"/>
<style>
/* â”€â”€â”€â”€â”€ RESET & TOKENS â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
*,*::before,*::after{box-sizing:border-box;margin:0;padding:0}
:root{
  /* Premium Zinc/Slate Dark Theme */
  --bg:#09090b; --s1:#18181b; --s2:#27272a; --s3:#3f3f46;
  --b1:rgba(255,255,255,0.08); --b2:rgba(255,255,255,0.15); 
  
  --tx:#f4f4f5; --tm:#a1a1aa; --td:#71717a;
  
  /* Sophisticated Accents */
  --gold:#eab308; --gold2:#d97706; --gold3:rgba(234, 179, 8, 0.12);
  --red:#f87171;  --rg:rgba(248, 113, 113, 0.12);
  --amb:#fbbf24;  --ag:rgba(251, 191, 36, 0.12);
  --grn:#34d399;  --gg:rgba(52, 211, 153, 0.12);
  --blu:#3b82f6;  --bg2:rgba(59, 130, 246, 0.12);
  
  --ff:'Inter', system-ui, sans-serif; --fm:'JetBrains Mono', monospace;
  --r8:8px; --r12:12px;
}

/* Custom Scrollbar */
::-webkit-scrollbar { width: 8px; height: 8px; }
::-webkit-scrollbar-track { background: var(--bg); }
::-webkit-scrollbar-thumb { background: var(--s3); border-radius: 4px; }
::-webkit-scrollbar-thumb:hover { background: var(--tm); }

html,body{min-height:100%;font-family:var(--ff);background:var(--bg);color:var(--tx);font-size:14px; -webkit-font-smoothing: antialiased;}
body{background-image:radial-gradient(ellipse 80% 50% at 10% 0%,rgba(234,179,8,.03) 0%,transparent 60%),radial-gradient(ellipse 60% 40% at 90% 100%,rgba(59,130,246,.03) 0%,transparent 60%)}

/* NAV */
.nav{position:sticky;top:0;z-index:100;height:64px;background:rgba(9,9,11,.90);backdrop-filter:blur(16px);border-bottom:1px solid var(--b1);display:flex;align-items:center;gap:16px;padding:0 28px}
.logo{width:36px;height:36px;border-radius:8px;background:linear-gradient(135deg,var(--gold),var(--gold2));display:flex;align-items:center;justify-content:center;font-size:16px;flex-shrink:0;box-shadow:0 0 16px rgba(234,179,8,.2); color: #000;}
.brand-t{font-size:16px;font-weight:700;letter-spacing:-.02em}
.brand-s{font-family:var(--fm);font-size:10px;color:var(--gold);letter-spacing:1px;margin-top:2px; font-weight: 500;}
.nsep{flex:1}
.nclk{font-family:var(--fm);font-size:13px;color:var(--tm);background:var(--s2);border:1px solid var(--b1);padding:6px 12px;border-radius:6px; font-weight: 500;}
.cpill{display:flex;align-items:center;gap:8px;font-family:var(--fm);font-size:12px;font-weight:600;letter-spacing:.5px;padding:7px 16px;border-radius:24px;border:1px solid var(--b1);cursor:pointer;transition:all .2s;user-select:none}
.cpill:hover{background: rgba(255,255,255,0.03);}
.cpulse{width:8px;height:8px;border-radius:50%;background:var(--td);flex-shrink:0}
.cpill.live{border-color:rgba(52,211,153,.3);color:var(--grn); background: var(--gg);}.cpill.live .cpulse{background:var(--grn);box-shadow:0 0 10px var(--grn);animation:blink 1.8s ease-in-out infinite}
.cpill.demo{border-color:rgba(234,179,8,.3);color:var(--gold); background: var(--gold3);}.cpill.demo .cpulse{background:var(--gold)}
.cpill.err{border-color:rgba(248,113,113,.3);color:var(--red); background: var(--rg);}.cpill.err .cpulse{background:var(--red);animation:blink .5s ease-in-out infinite}
.cpill.load .cpulse{background:var(--blu);animation:blink .3s linear infinite}
@keyframes blink{0%,100%{opacity:1}50%{opacity:.3}}
.nbtn{padding:8px 16px;border-radius:6px;font-size:13px;font-weight:600;cursor:pointer;border:none;font-family:var(--ff);transition:all .2s;letter-spacing:.2px}
.btn-gold{background:var(--gold);color:#09090b;box-shadow:0 2px 8px rgba(234,179,8,.2)}.btn-gold:hover{background:#facc15; box-shadow:0 4px 16px rgba(234,179,8,.3);transform:translateY(-1px)}
.btn-ghost{background:transparent;border:1px solid var(--b2);color:var(--tx)}.btn-ghost:hover{border-color:var(--gold);color:var(--gold); background:rgba(255,255,255,0.02);}

/* DRAWER */
.drawer{position:fixed;top:64px;right:0;bottom:0;width:440px;z-index:90;background:rgba(24,24,27,0.95);backdrop-filter:blur(20px);border-left:1px solid var(--b1);transform:translateX(100%);transition:transform .4s cubic-bezier(0.16, 1, 0.3, 1);overflow-y:auto;padding:32px;display:flex;flex-direction:column;gap:20px}
.drawer.open{transform:translateX(0);box-shadow:-24px 0 80px rgba(0,0,0,.6)}
.dh{font-size:18px;font-weight:700; letter-spacing: -0.01em;}.ds{font-size:13px;color:var(--tm);line-height:1.6}
.fld label{display:block;font-size:11px;font-weight:600;color:var(--tm);letter-spacing:0.5px;text-transform:uppercase;margin-bottom:8px}
.fld input,.fld select{width:100%;background:var(--bg);border:1px solid var(--b2);color:var(--tx);border-radius:6px;padding:12px 14px;font-size:13px;font-family:var(--fm);outline:none;transition:all .2s}
.fld input:focus,.fld select:focus{border-color:var(--gold);box-shadow:0 0 0 2px rgba(234,179,8,.15)}
.sbox{background:rgba(255,255,255,.02);border:1px solid var(--b1);border-radius:8px;padding:16px}
.sn{font-size:11px;font-weight:700;color:var(--gold);letter-spacing:.5px;margin-bottom:6px; font-family:var(--ff);}
.st{font-size:13px;color:var(--tm);line-height:1.6}
.st code{background:var(--s2);color:var(--tx);padding:2px 6px;border-radius:4px;font-family:var(--fm);font-size:12px; border: 1px solid var(--b1);}
.tbox{background:var(--gg);border:1px solid rgba(52,211,153,.2);border-radius:6px;padding:12px;font-family:var(--fm);font-size:12px;color:var(--grn);display:none;margin-top:4px;max-height:150px;overflow-y:auto;line-height:1.6;white-space:pre-wrap}
.tbox.show{display:block}.tbox.fail{background:var(--rg);border-color:rgba(248,113,113,.2);color:var(--red)}
.btn{padding:10px 18px;border-radius:6px;font-size:13px;font-weight:600;cursor:pointer;border:none;font-family:var(--ff);transition:all .2s}
.b-p{background:var(--gold);color:#09090b}.b-p:hover{background:#facc15; box-shadow:0 4px 16px rgba(234,179,8,.3); transform:translateY(-1px);}
.b-g{background:transparent;border:1px solid var(--b2);color:var(--tx)}.b-g:hover{border-color:var(--gold);color:var(--gold); background:rgba(255,255,255,0.02);}
.b-w{background:transparent;border:1px solid rgba(251,191,36,.3);color:var(--amb)}.b-w:hover{background:var(--ag);}
.dacts{display:flex;gap:12px;flex-wrap:wrap; margin-top: 8px;}

/* LOAD VEIL */
#lveil{display:none;position:fixed;inset:0;z-index:200;background:rgba(9,9,11,.90);backdrop-filter:blur(4px);align-items:center;justify-content:center;flex-direction:column;gap:20px}
#lveil.on{display:flex}
.spin{width:48px;height:48px;border:3px solid rgba(234,179,8,.15);border-top-color:var(--gold);border-radius:50%;animation:spin .8s cubic-bezier(0.4, 0, 0.2, 1) infinite}
@keyframes spin{to{transform:rotate(360deg)}}
#ltxt{font-family:var(--fm);font-size:14px;color:var(--tx); font-weight: 500;}

/* PAGE */
.page{position:relative;z-index:1;padding:24px 32px 60px}

/* SOURCE BAR */
.sbar{display:flex;align-items:center;gap:16px;flex-wrap:wrap;background:var(--s1);border:1px solid var(--b1);border-radius:8px;padding:12px 20px;margin-bottom:24px;font-size:13px}
.slbl{font-size:11px;font-weight:600;color:var(--tm);letter-spacing:.5px;text-transform:uppercase}
.sval{font-family:var(--fm);font-size:13px;color:var(--tx); font-weight: 500;}
.sdiv{width:1px;height:16px;background:var(--b2)}
#ntxt{color:var(--grn);font-weight:600}

/* KPI */
.krow{display:grid;grid-template-columns:repeat(6,1fr);gap:16px;margin-bottom:20px}
@media(max-width:1400px){.krow{grid-template-columns:repeat(3,1fr)}}
@media(max-width:800px){.krow{grid-template-columns:repeat(2,1fr)}}
.kcard{background:var(--s1);border:1px solid var(--b1);border-radius:12px;padding:20px 24px;position:relative;overflow:hidden;transition:all .2s ease;cursor:default; box-shadow: 0 4px 6px -1px rgba(0,0,0,0.1);}
.kcard:hover{transform:translateY(-2px);box-shadow:0 12px 30px rgba(0,0,0,.4);border-color:var(--b2)}
.kt{content:'';position:absolute;top:0;left:0;right:0;height:3px;}
.klbl{font-size:12px;font-weight:600;letter-spacing:0.5px;text-transform:uppercase;color:var(--tm);margin-bottom:12px}
.kval{font-size:32px;font-weight:700;font-family:var(--fm);line-height:1;letter-spacing:-1px}
.ksub{font-size:12px;color:var(--td);margin-top:8px}

/* BODY GRID */
.bgrid{display:grid;grid-template-columns:1fr 340px;gap:20px}
@media(max-width:1100px){.bgrid{grid-template-columns:1fr}}

/* CARD */
.card{background:var(--s1);border:1px solid var(--b1);border-radius:12px;overflow:hidden; box-shadow: 0 4px 6px -1px rgba(0,0,0,0.1);}
.ch{padding:16px 24px;border-bottom:1px solid var(--b1);display:flex;align-items:center;justify-content:space-between; background: rgba(255,255,255,0.01);}
.cht{font-size:16px;font-weight:600;display:flex;align-items:center;gap:12px; letter-spacing: -0.01em;}
.mc{font-family:var(--fm);font-size:11px;font-weight:600;letter-spacing:.2px;padding:4px 10px;border-radius:6px}

/* FILTER BAR */
.fbar{padding:16px 24px;border-bottom:1px solid var(--b1);display:flex;align-items:center;gap:12px;flex-wrap:wrap; background: rgba(255,255,255,0.005);}
.mpill{font-size:13px;font-weight:500;padding:6px 14px;border-radius:6px;border:1px solid var(--b1);background:transparent;color:var(--tm);cursor:pointer;transition:all .2s ease;}
.mpill:hover{color: var(--tx); background: rgba(255,255,255,0.03);}
.mpill.on{background:var(--gold);color:#09090b;border-color:var(--gold); font-weight: 600;}
.vd{width:1px;height:24px;background:var(--b2);flex-shrink:0; margin: 0 4px;}
.fsel{background:var(--s2);border:1px solid var(--b1);color:var(--tx);border-radius:6px;padding:7px 12px;font-size:13px;outline:none;cursor:pointer;transition:all .2s}
.fsel:focus{border-color:var(--gold); box-shadow:0 0 0 2px rgba(234,179,8,.15);}
.srch{position:relative;flex:1;min-width:140px;max-width:240px; margin-left: auto;}
.srch input{width:100%;background:var(--s2);border:1px solid var(--b1);color:var(--tx);border-radius:6px;padding:7px 12px 7px 32px;font-size:13px;outline:none;transition:all .2s}
.srch input:focus{border-color:var(--gold); box-shadow:0 0 0 2px rgba(234,179,8,.15);}
.si{position:absolute;left:10px;top:50%;transform:translateY(-50%);font-size:14px;color:var(--tm)}

/* TABS */
.tabs{padding:16px 24px 0;display:flex;gap:4px; border-bottom: 1px solid var(--b1);}
.tab{font-size:13px;font-weight:500;padding:8px 20px;border-radius:8px 8px 0 0;border:1px solid transparent;border-bottom:none;background:transparent;color:var(--tm);cursor:pointer;font-family:var(--ff);transition:all .2s; position: relative;}
.tab:hover{color:var(--tx);}
.tab.on{color:var(--gold); font-weight: 600;}
.tab.on::after{content:''; position: absolute; bottom: -1px; left: 0; right: 0; height: 2px; background: var(--gold);}

/* TABLE */
.tw{overflow-x:auto}
table{width:100%;border-collapse:separate; border-spacing: 0;}
th{padding:14px 20px;text-align:left;font-size:11px;font-weight:600;text-transform:uppercase;letter-spacing:0.05em;color:var(--tm);border-bottom:1px solid var(--b1);cursor:pointer;white-space:nowrap;background:rgba(255,255,255,.015);user-select:none; transition: color 0.2s;}
th:hover{color:var(--tx)}
td{padding:14px 20px;border-bottom:1px solid rgba(255,255,255,.03);vertical-align:middle; font-size: 13px;}
tr{cursor:pointer;transition:background .15s}
tr:hover td{background:rgba(255,255,255,.025)}
tr:last-child td{border-bottom:none}
.idc{font-family:var(--fm);font-size:12px;color:var(--tm)}
.nc{font-weight:600;font-size:14px; color: var(--tx);}
.itag{font-size:11px;font-weight:500;padding:3px 8px;border-radius:4px;background:var(--s2);color:var(--tx);border:1px solid var(--b1)}
.sw{display:flex;align-items:center;gap:10px}
.sv{font-family:var(--fm);font-weight:600;font-size:14px;min-width:28px}
.sb{flex:1; max-width: 64px; height:4px;background:rgba(255,255,255,.08);border-radius:2px;overflow:hidden}
.sbf{height:100%;border-radius:2px; transition: width 0.6s cubic-bezier(0.4, 0, 0.2, 1);}
.badge{display:inline-flex;align-items:center;gap:6px;font-size:11px;font-weight:600;letter-spacing:0.02em;padding:4px 10px;border-radius:6px}
.b-r{background:var(--rg);color:var(--red);border:1px solid rgba(248,113,113,.2)}
.b-a{background:var(--ag);color:var(--amb);border:1px solid rgba(251,191,36,.2)}
.b-g{background:var(--gg);color:var(--grn);border:1px solid rgba(52,211,153,.2)}
.dot{width:6px;height:6px;border-radius:50%}
.mf{font-family:var(--fm);font-size:13px}
.tfoot{padding:16px 24px;border-top:1px solid var(--b1);font-size:12px;color:var(--td);line-height:1.6}

/* RIGHT PANEL */
.pcol{display:flex;flex-direction:column;gap:20px}

/* DONUT */
.da{padding:24px;display:flex;flex-direction:column;align-items:center}
.dr{position:relative;width:160px;height:160px}
.dc{position:absolute;inset:0;display:flex;flex-direction:column;align-items:center;justify-content:center;pointer-events:none}
.dnum{font-size:32px;font-weight:700;font-family:var(--fm);color:var(--tx); letter-spacing: -0.02em;}
.dlbl{font-size:11px; font-weight: 500; color:var(--tm);letter-spacing:1px}
.dleg{margin-top:24px;width:100%;display:flex;flex-direction:column;gap:12px}
.dlr{display:flex;align-items:center;justify-content:space-between;font-size:13px}
.dll{display:flex;align-items:center;gap:10px}
.dlc{width:8px;height:8px;border-radius:50%}
.dlv{font-family:var(--fm);font-weight:600;font-size:13px}

/* TOP RISK */
.trl{padding:8px 0}
.tri{display:flex;align-items:center;gap:14px;padding:12px 24px;border-bottom:1px solid rgba(255,255,255,.03);cursor:pointer;transition:background .2s}
.tri:hover{background:rgba(255,255,255,.02)}.tri:last-child{border-bottom:none}
.trk{width:24px;height:24px;border-radius:6px;display:flex;align-items:center;justify-content:center;font-family:var(--fm);font-size:12px;font-weight:700;flex-shrink:0}
.tri-info{flex:1;min-width:0}
.tri-nm{font-size:13px;font-weight:600;white-space:nowrap;overflow:hidden;text-overflow:ellipsis}
.tri-mt{font-size:12px;color:var(--tm);margin-top:2px}
.tri-rt{text-align:right;flex-shrink:0}
.tri-sc{font-family:var(--fm);font-size:16px;font-weight:700;line-height:1}
.tri-ex{font-family:var(--fm);font-size:11px;color:var(--tm); margin-top:2px;}

/* HEALTH */
.ha{padding:20px 24px;display:flex;flex-direction:column;gap:16px}
.hbl{display:flex;justify-content:space-between;font-size:13px;margin-bottom:6px}
.hbn{color:var(--tm); font-weight: 500;}.hbv{font-family:var(--fm);font-weight:600}
.hbt{height:6px;background:rgba(255,255,255,.06);border-radius:3px;overflow:hidden}
.hbf{height:100%;border-radius:3px;transition:width .9s cubic-bezier(.4,0,.2,1)}

/* ALERTS */
.al{padding:8px 24px 16px}
.ali{display:flex;gap:12px;align-items:flex-start;padding:12px 0;border-bottom:1px solid rgba(255,255,255,.03)}
.ali:last-child{border-bottom:none}
.ali-msg{font-size:13px;line-height:1.6;color:var(--tm)}
.ali-msg strong{color:var(--tx);font-weight:600}
.ali-t{font-family:var(--fm);font-size:11px;color:var(--td);margin-top:6px; letter-spacing: 0.02em;}

/* TREND */
.tra{padding:20px 24px}

/* MODAL */
.mv{display:none;position:fixed;inset:0;background:rgba(9,9,11,.8);backdrop-filter:blur(6px);-webkit-backdrop-filter:blur(6px);z-index:300;align-items:center;justify-content:center}
.mv.on{display:flex;animation:fi .2s ease}
@keyframes fi{from{opacity:0}to{opacity:1}}
.modal{background:var(--s1);border:1px solid var(--b1);border-radius:16px;width:760px;max-width:96vw;max-height:90vh;overflow-y:auto;box-shadow:0 32px 80px rgba(0,0,0,.7);animation:ms .3s cubic-bezier(0.16, 1, 0.3, 1)}
@keyframes ms{from{transform:scale(.96) translateY(20px);opacity:0}to{transform:none;opacity:1}}
.mh{padding:24px;border-bottom:1px solid var(--b1);display:flex;align-items:center;justify-content:space-between;position:sticky;top:0;background:rgba(24,24,27,0.95); backdrop-filter: blur(8px); z-index:1}
.mht{font-size:18px;font-weight:600; letter-spacing: -0.01em;}
.xcl{width:32px;height:32px;border-radius:8px;background:rgba(255,255,255,.05);border:none;color:var(--tm);font-size:18px;cursor:pointer;display:flex;align-items:center;justify-content:center;transition:all .2s}
.xcl:hover{background:var(--rg);color:var(--red)}
.mb{padding:24px}
.mg{display:grid;grid-template-columns:1fr 1fr 1fr;gap:12px;margin-bottom:24px}
.mbox{background:rgba(255,255,255,.02);border:1px solid var(--b1);border-radius:8px;padding:16px}
.mbl{font-size:11px;font-weight:600;color:var(--tm);letter-spacing:0.05em;margin-bottom:8px; text-transform: uppercase;}
.mbv{font-size:24px;font-weight:700;font-family:var(--fm); letter-spacing:-0.02em;}
.msh{font-size:12px;font-weight:600;letter-spacing:0.05em;text-transform:uppercase;color:var(--tx);border-bottom:1px solid var(--b1);padding-bottom:8px;margin:28px 0 16px}
.frow{display:flex;align-items:center;gap:16px;padding:10px 0;border-bottom:1px solid rgba(255,255,255,.03);font-size:13px}
.frow:last-child{border-bottom:none}
.fn{color:var(--tm);min-width:160px; font-weight:500;}.fw{font-family:var(--fm);font-size:11px;color:var(--td)}
.fbt{flex:1;height:6px;background:rgba(255,255,255,.06);border-radius:3px;overflow:hidden}
.fbf{height:100%;border-radius:3px}
.fsc{font-family:var(--fm);font-weight:600;min-width:36px;text-align:right;font-size:13px}
.hrow{display:flex;gap:8px;flex-wrap:wrap;margin-top:12px}
.hchip{padding:6px 12px;border-radius:6px;font-size:12px;font-weight:600;font-family:var(--fm); border: 1px solid transparent;}
.abox{background:rgba(59,130,246,.05);border:1px solid rgba(59,130,246,.2);border-radius:12px;padding:18px 20px;font-size:14px;color:var(--tm);line-height:1.6}
.macts{display:flex;justify-content:flex-end;gap:12px;margin-top:28px; padding-top: 20px; border-top: 1px solid var(--b1);}

/* REFRESH BAR */
#rbar{position:fixed;bottom:24px;right:24px;z-index:90;background:rgba(24,24,27,0.95); backdrop-filter:blur(10px); border:1px solid var(--b2);border-radius:8px;padding:12px 20px;display:flex;align-items:center;gap:12px;font-size:13px;transform:translateY(100px);transition:transform .4s cubic-bezier(0.16, 1, 0.3, 1);box-shadow:0 12px 40px rgba(0,0,0,.5)}
#rbar.show{transform:translateY(0)}
.rdot{width:8px;height:8px;border-radius:50%;background:var(--grn);box-shadow:0 0 8px var(--grn);animation:blink .8s ease-in-out infinite}
</style>
</head>
<body>

<div id="lveil"><div class="spin"></div><div id="ltxt">Connecting to n8nâ€¦</div></div>

<nav class="nav">
  <div class="logo">âš¡</div>
  <div>
    <div class="brand-t">Vayana SCF Risk</div>
    <div class="brand-s">INTELLIGENCE PLATFORM</div>
  </div>
  <div class="nsep"></div>
  <div class="nclk" id="clk"></div>
  <div class="cpill demo" id="cpill" onclick="toggleDrawer()">
    <div class="cpulse"></div>
    <span id="cpill-txt">DEMO MODE</span>
  </div>
  <button class="nbtn btn-ghost" onclick="toggleDrawer()">âš™ Configure</button>
  <button class="nbtn btn-gold" onclick="manualRefresh()">â†» Refresh</button>
</nav>

<div class="drawer" id="drawer">
  <div><div class="dh">ğŸ”Œ Connect to n8n Webhook</div>
  <div class="ds" style="margin-top:8px">Paste your ngrok URL. Dashboard fetches live scored data from n8n every 5 min.</div></div>
  <div class="sbox"><div class="sn">STEP 1 â€” RUN NGROK</div><div class="st">In terminal: <code>docker start n8n</code> then <code>ngrok http 5678</code></div></div>
  <div class="sbox"><div class="sn">STEP 2 â€” COPY URL</div><div class="st">Copy the <code>https://xxxx.ngrok-free.app</code> URL from the ngrok terminal window.</div></div>
  <div class="sbox"><div class="sn">STEP 3 â€” ACTIVATE WORKFLOW</div><div class="st">Open <code>localhost:5678</code> â†’ Vayana SCF FIXED v3 â†’ toggle Active ON.</div></div>
  
  <div class="fld"><label>N8N Webhook Base URL</label>
    <input type="text" id="cfg-url" value="https://clemently-changeful-krista.ngrok-free.dev" placeholder="https://xxxx.ngrok-free.app"/>
  </div>
  
  <div class="fld"><label>Auto-Refresh Interval</label>
    <select id="cfg-ref">
      <option value="300000">Every 5 minutes</option>
      <option value="120000">Every 2 minutes</option>
      <option value="600000">Every 10 minutes</option>
      <option value="0">Manual only</option>
    </select></div>
  <div class="tbox" id="tbox"></div>
  <div class="dacts">
    <button class="btn b-p" onclick="connectWebhook()">ğŸ”— Connect & Load</button>
    <button class="btn b-g" onclick="testConn()">ğŸ§ª Test</button>
    <button class="btn b-w" onclick="useDemo()">Demo Mode</button>
  </div>
  <div style="font-size:11px;color:var(--td);font-family:var(--ff);line-height:1.6;border-top:1px solid var(--b1);padding-top:16px">n8n + ngrok must both be running<br/>Workflow must be Active in n8n<br/>CORS headers set in workflow JSON</div>
</div>

<div class="page">
  <div class="krow" id="krow"></div>
  <div class="sbar">
    <span class="slbl">Source</span><span class="sval" id="src-lbl">Demo Data Â· Aug 2025 â€“ Jan 2026</span>
    <div class="sdiv"></div>
    <span class="slbl">Last Fetched</span><span class="sval" id="last-txt">â€”</span>
    <div class="sdiv"></div>
    <span class="slbl">Next Refresh</span><span class="sval" id="ntxt">â€”</span>
  </div>
  <div class="bgrid">
    <div style="display:flex;flex-direction:column;gap:20px">
      <div class="card">
        <div class="ch">
          <div class="cht">Client Risk Portfolio <span class="mc" id="tbl-cnt" style="background:var(--gold3);color:var(--gold)">50 clients</span></div>
          <span style="font-size:12px;color:var(--tm); font-weight: 500;">Click row for full analysis</span>
        </div>
        <div class="fbar">
          <div id="mpills" style="display: flex; gap: 6px;"></div>
          <div class="vd"></div>
          <select class="fsel" id="sel-ind" onchange="applyF()">
            <option value="">All Industries</option>
            <option>Manufacturing</option><option>FMCG</option><option>Pharma</option>
            <option>Auto Ancillary</option><option>Textile</option><option>Electronics</option><option>Chemical</option>
          </select>
          <select class="fsel" id="sel-tier" onchange="applyF()">
            <option value="">All Tiers</option>
            <option value="HIGH">ğŸ”´ HIGH</option>
            <option value="MEDIUM">ğŸŸ¡ MEDIUM</option>
            <option value="LOW">ğŸŸ¢ LOW</option>
          </select>
          <div class="srch"><span class="si">ğŸ”</span><input type="text" id="srch" placeholder="Searchâ€¦" oninput="applyF()"/></div>
        </div>
        <div class="tabs">
          <button class="tab on" onclick="switchTab(this,'tbl')">Risk Table</button>
          <button class="tab" onclick="switchTab(this,'trend')">6-Month Trend</button>
          <button class="tab" onclick="switchTab(this,'alerts')">Alerts</button>
        </div>
        <div id="v-tbl">
          <div class="tw">
            <table>
              <thead><tr>
                <th onclick="srt('client_id')">ID</th>
                <th onclick="srt('company_name')">Company â†•</th>
                <th onclick="srt('industry')">Industry</th>
                <th onclick="srt('risk_score')">Score â†•</th>
                <th onclick="srt('risk_tier')">Tier</th>
                <th onclick="srt('dpd')">DPD â†•</th>
                <th onclick="srt('utilization')">Util%</th>
                <th onclick="srt('dso')">DSO</th>
                <th onclick="srt('overdue_pct')">Ovd%</th>
                <th onclick="srt('exposure_cr')">Exposure</th>
                <th></th>
              </tr></thead>
              <tbody id="tbody"></tbody>
            </table>
          </div>
          <div class="tfoot">
            <strong style="color:var(--tx)">Risk Formula:</strong> Score = DPD(30%) + Util(20%) + DSO/DPO(20%) + Overdue%(15%) + TxnFreq(10%) + Breaches(5%)
            &nbsp;|&nbsp; HIGH â‰¥65 Â· MEDIUM 35â€“64 Â· LOW &lt;35
            &nbsp;|&nbsp; <span id="foot-src" style="color:var(--amb)">Demo mode</span>
          </div>
        </div>
        <div id="v-trend" style="display:none"><div class="tra"><canvas id="tcanvas" height="300"></canvas></div></div>
        <div id="v-alerts" style="display:none"><div class="al" id="alist"></div></div>
      </div>
    </div>
    <div class="pcol">
      <div class="card"><div class="ch"><div class="cht">Risk Distribution</div></div>
        <div class="da">
          <div class="dr">
            <svg id="dsvg" viewBox="0 0 160 160" width="160" height="160" style="transform:rotate(-90deg)"></svg>
            <div class="dc"><div class="dnum" id="dnum">50</div><div class="dlbl">CLIENTS</div></div>
          </div>
          <div class="dleg" id="dleg"></div>
        </div>
      </div>
      <div class="card">
        <div class="ch"><div class="cht">ğŸ”´ Top At-Risk</div><div class="mc" style="background:var(--rg);color:var(--red); border: 1px solid rgba(248,113,113,0.2)">URGENT</div></div>
        <div class="trl" id="top-list"></div>
      </div>
      <div class="card">
        <div class="ch"><div class="cht">Portfolio Health</div></div>
        <div class="ha" id="h-area"></div>
      </div>
    </div>
  </div>
</div>

<div id="rbar"><div class="rdot"></div><span style="color:var(--tm)">Next refresh in</span><span id="rbcd" style="color:var(--grn);font-weight:600;font-family:var(--fm)">5:00</span></div>

<div class="mv" id="mv" onclick="closeM(event)">
  <div class="modal" onclick="event.stopPropagation()">
    <div class="mh"><div class="mht" id="m-title"></div><button class="xcl" onclick="closeM(null)">âœ•</button></div>
    <div class="mb" id="m-body"></div>
  </div>
</div>

<script>
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// SCORING ENGINE
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function scoreLocal(c) {
  var fd = Math.min((c.dpd/90)*100, 100);
  var fu = Math.min(c.utilization, 100);
  var fs = Math.min(((c.dso/(c.dpo||30))/3)*100, 100);
  var fo = Math.min(c.overdue_pct, 100);
  var ft = Math.max(0, 100-(c.txn_frequency/20)*100);
  var fb = Math.min(c.credit_breach*20, 100);
  var s  = Math.round(fd*.30+fu*.20+fs*.20+fo*.15+ft*.10+fb*.05);
  return {
    risk_score: s,
    risk_tier: s>=65 ? 'HIGH' : s>=35 ? 'MEDIUM' : 'LOW',
    factors: {
      dpd: Math.round(fd), util: Math.round(fu), dso: Math.round(fs),
      ovd: Math.round(fo), txn: Math.round(ft), breach: Math.round(fb)
    }
  };
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// DEMO DATA
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
var MONTHS = ['Aug-25','Sep-25','Oct-25','Nov-25','Dec-25','Jan-26'];
var MKEYS  = ['SCF_Aug25','SCF_Sep25','SCF_Oct25','SCF_Nov25','SCF_Dec25','SCF_Jan26'];
var BASES = [
  ['VYN-001','Bharat Steel Works','Manufacturing','Tata Steel','Maharashtra',5.0,85,'Tier-1'],
  ['VYN-002','Sunrise FMCG Ltd','FMCG','HUL','Gujarat',3.2,28,'Tier-1'],
  ['VYN-003','MedPlus Pharma','Pharma','Sun Pharma','Telangana',2.8,20,'Tier-2'],
  ['VYN-004','Krishna Auto Parts','Auto Ancillary','Maruti Suzuki','Karnataka',4.5,70,'Tier-1'],
  ['VYN-005','Textronix Mills','Textile','Arvind Ltd','Rajasthan',1.8,14,'Tier-3'],
  ['VYN-006','Apex Electronics','Electronics','Samsung India','Tamil Nadu',6.0,112,'Tier-1'],
  ['VYN-007','Global Chemicals','Chemical','Reliance Ind','Gujarat',3.5,50,'Tier-2'],
  ['VYN-008','Rajiv Foods Corp','FMCG','ITC Ltd','Punjab',2.2,26,'Tier-2'],
  ['VYN-009','NovaPharma Pvt','Pharma','Cipla','Mumbai',4.8,68,'Tier-1'],
  ['VYN-010','Speedway Autos','Auto Ancillary','Hero MotoCorp','Haryana',3.0,36,'Tier-2'],
  ['VYN-011','Weavers Guild','Textile','Raymond','MP',5.5,82,'Tier-1'],
  ['VYN-012','TechVision Elec','Electronics','LG India','Delhi',2.5,28,'Tier-2'],
  ['VYN-013','PetroBase Chem','Chemical','ONGC','Gujarat',4.2,60,'Tier-2'],
  ['VYN-014','Amrit Dairy','FMCG','Amul','Gujarat',1.5,12,'Tier-3'],
  ['VYN-015','LifeGen Pharma','Pharma',"Dr Reddy's",'Hyderabad',3.8,48,'Tier-2'],
  ['VYN-016','SteelArch Mfg','Manufacturing','SAIL','Jharkhand',6.5,122,'Tier-1'],
  ['VYN-017','CottonKing Mills','Textile','Vardhman','Punjab',2.8,34,'Tier-2'],
  ['VYN-018','PowerGrid Elec','Electronics','Havells','Noida',3.3,44,'Tier-2'],
  ['VYN-019','OmniChem Solutions','Chemical','UPL Ltd','Maharashtra',1.9,18,'Tier-3'],
  ['VYN-020','Metro Foods','FMCG','Nestle India','Mumbai',4.0,56,'Tier-2'],
  ['VYN-021','Precision Parts','Auto Ancillary','Bosch India','Bangalore',5.8,96,'Tier-1'],
  ['VYN-022','VitaPlus Pharma','Pharma','Lupin','Pune',2.1,24,'Tier-3'],
  ['VYN-023','IndiaWire Mfg','Manufacturing','Sterlite','Tamil Nadu',3.7,46,'Tier-2'],
  ['VYN-024','SilkRoute Textile','Textile','Welspun','Gujarat',4.4,66,'Tier-1'],
  ['VYN-025','NextGen Circuits','Electronics','Wipro','Bangalore',2.9,38,'Tier-2'],
  ['VYN-026','AgriChem Corp','Chemical','Bayer India','Mumbai',5.2,88,'Tier-1'],
  ['VYN-027','FreshBite FMCG','FMCG','Dabur','Delhi',1.7,16,'Tier-3'],
  ['VYN-028','ZenPharma Ltd','Pharma','Zydus','Ahmedabad',6.0,102,'Tier-1'],
  ['VYN-029','TurboAuto Comp','Auto Ancillary','Motherson','Noida',3.1,40,'Tier-2'],
  ['VYN-030','RoyalWeave Mills','Textile','Bombay Dyeing','Mumbai',2.4,30,'Tier-3'],
  ['VYN-031','Sigma Electronics','Electronics','Panasonic','Pune',4.7,74,'Tier-1'],
  ['VYN-032','BlueStar Chemicals','Chemical','Aarti Ind','Gujarat',2.6,32,'Tier-2'],
  ['VYN-033','FoodFirst Ltd','FMCG','Britannia','Kolkata',5.0,84,'Tier-1'],
  ['VYN-034','Bharat Forgings','Manufacturing','Bharat Forge','Pune',3.6,50,'Tier-2'],
  ['VYN-035','CareMed Pharma','Pharma','Alkem','Mumbai',1.3,14,'Tier-3'],
  ['VYN-036','SpeedFit Auto','Auto Ancillary','TVS Motors','Chennai',4.6,70,'Tier-1'],
  ['VYN-037','NorthStar Textile','Textile','KPR Mill','Tamil Nadu',3.0,42,'Tier-2'],
  ['VYN-038','BrightChip Tech','Electronics','Dixon Tech','Noida',2.2,26,'Tier-3'],
  ['VYN-039','ReactiChem','Chemical','Deepak Nitrite','Gujarat',5.6,94,'Tier-1'],
  ['VYN-040','TastyBite Foods','FMCG','MDH','Delhi',1.9,20,'Tier-3'],
  ['VYN-041','Paramount Steel','Manufacturing','JSW Steel','Mumbai',6.8,132,'Tier-1'],
  ['VYN-042','HealWell Pharma','Pharma','Mankind','Delhi',4.1,58,'Tier-2'],
  ['VYN-043','DriveKing Autos','Auto Ancillary','Ashok Leyland','Chennai',2.7,34,'Tier-2'],
  ['VYN-044','FiberMax Textile','Textile','Indo Count','Maharashtra',3.5,50,'Tier-2'],
  ['VYN-045','DigiPulse Elec','Electronics','Micromax','Gurugram',5.1,86,'Tier-1'],
  ['VYN-046','ClearChem Ind','Chemical','Tata Chemicals','Mumbai',2.0,22,'Tier-3'],
  ['VYN-047','GreenLeaf FMCG','FMCG','Marico','Mumbai',3.8,54,'Tier-2'],
  ['VYN-048','SpectraPharma','Pharma','Torrent','Ahmedabad',1.6,18,'Tier-3'],
  ['VYN-049','CoreMech Mfg','Manufacturing','L&T','Mumbai',4.3,66,'Tier-2'],
  ['VYN-050','AquaFlux Chem','Chemical','Vinati Org','Maharashtra',2.8,40,'Tier-2']
];

function rn(sd, lo, hi, d) {
  d = d || 0;
  var v = lo + (Math.abs(Math.sin(sd)*99991)%1) * (hi - lo);
  return d ? parseFloat(v.toFixed(d)) : Math.round(v);
}

var DEMO = {};
MONTHS.forEach(function(mo, mi) {
  DEMO[mo] = BASES.map(function(b, ci) {
    var rf = b[6]/132;
    var sd = (ci+1)*100 + mi*41 + 5000;
    var sea = 1 + mi*0.06;
    var dpd     = rn(sd+1, 0, rf*95*sea);
    var util    = rn(sd+2, 25+rf*30, Math.min(98, 52+rf*50*sea), 1);
    var dso     = rn(sd+3, 18+rf*48, 44+rf*68*sea);
    var dpo     = rn(sd+4, 22, 80);
    var inv     = rn(sd+5, 100, 2500+rf*3000, 1);
    var dis     = rn(sd+6, inv*0.65, inv*0.96, 1);
    var out     = rn(sd+7, dis*0.25, dis*0.9, 1);
    var ovd     = rn(sd+8, 0, out*rf*0.55, 1);
    var ovdp    = out > 0 ? rn(sd+9, 0, rf*50, 1) : 0;
    var txn     = rn(sd+10, 2, 24);
    var br      = rn(sd+11, 0, rf*4*sea);
    var pay     = rn(sd+12, Math.max(35, 55-rf*34), 97-rf*18);
    var cr      = rn(sd+13, 0.72, 2.7-rf*1.1, 2);
    var de      = rn(sd+14, 0.22, 1+rf*2, 2);
    var exp     = rn(sd+15, b[5]*0.52, b[5]*1.25, 2);
    var ic      = rn(sd+16, 3, 32);
    var raw = {
      client_id:b[0], company_name:b[1], industry:b[2], anchor_buyer:b[3], state:b[4],
      month:mo, credit_limit_cr:b[5], buyer_tier:b[7],
      invoice_count:ic, invoice_value:inv, disbursed:dis, outstanding:out,
      overdue_amt:ovd, overdue_pct:ovdp, dpd:dpd, utilization:util,
      dso:dso, dpo:dpo, txn_frequency:txn, credit_breach:br,
      payment_score:pay, current_ratio:cr, debt_equity:de, exposure_cr:exp, analyst_flag:''
    };
    var sc = scoreLocal(raw);
    raw.risk_score  = sc.risk_score;
    raw.risk_tier   = sc.risk_tier;
    raw.factors     = sc.factors;
    return raw;
  });
});

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// APP STATE
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
var DS      = JSON.parse(JSON.stringify(DEMO));
var activeM = 'Jan-26';
var filtered = [];
var sortK   = 'risk_score';
var sortAsc = false;
var mode    = 'demo';
var wUrl    = '';
var refMs   = 300000;
var refTimer = null;
var refCd   = 0;

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// WEBHOOK
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function normalizeClients(clients) {
  return clients.map(function(c) {
    var raw = {
      client_id: c.client_id||'', company_name: c.company_name||'',
      industry: c.industry||'', anchor_buyer: c.anchor_buyer||'',
      state: c.state||'', month: c.month||activeM,
      credit_limit_cr: +c.credit_limit_cr||0, buyer_tier: c.buyer_tier||'Tier-2',
      invoice_count: +c.invoice_count||0, invoice_value: +c.invoice_value||0,
      disbursed: +c.disbursed||0, outstanding: +c.outstanding||0,
      overdue_amt: +c.overdue_amt||0, overdue_pct: +c.overdue_pct||0,
      exposure_cr: +c.exposure_cr||0, dpd: +c.dpd||0,
      utilization: +c.utilization||0, dso: +c.dso||0, dpo: +c.dpo||0,
      txn_frequency: +c.txn_frequency||0, credit_breach: +c.credit_breach||0,
      payment_score: +c.payment_score||70, current_ratio: +c.current_ratio||1,
      debt_equity: +c.debt_equity||1, analyst_flag: c.analyst_flag||''
    };
    if (c.risk_score && c.risk_tier && c.factors) {
      raw.risk_score = c.risk_score; raw.risk_tier = c.risk_tier; raw.factors = c.factors;
    } else {
      var s = scoreLocal(raw);
      raw.risk_score = s.risk_score; raw.risk_tier = s.risk_tier; raw.factors = s.factors;
    }
    return raw;
  });
}

function fetchMonth(mk, ml) {
  return fetch(wUrl + '/webhook/scf-risk?month=' + mk, {
    method: 'GET',
    headers: { 'Accept': 'application/json', 'ngrok-skip-browser-warning': 'true' }
  }).then(function(r) {
    if (!r.ok) throw new Error('HTTP ' + r.status);
    return r.json();
  }).then(function(d) {
    if (!d.clients) throw new Error('No clients in response');
    return { label: ml, clients: normalizeClients(d.clients) };
  });
}

function connectWebhook() {
  var url = document.getElementById('cfg-url').value.trim().replace(/\/$/, '');
  if (!url) { alert('Please enter your n8n webhook URL.'); return; }
  wUrl = url;
  refMs = parseInt(document.getElementById('cfg-ref').value);
  document.getElementById('drawer').classList.remove('open');
  showLoad('Connecting to n8n â€” fetching 6 monthsâ€¦');
  var promises = MONTHS.map(function(ml, i) {
    return fetchMonth(MKEYS[i], ml).then(function(r) {
      return { ok: true, i: i, r: r };
    }).catch(function(e) {
      return { ok: false, i: i, e: e };
    });
  });
  Promise.all(promises).then(function(results) {
    var ok = 0;
    results.forEach(function(res) {
      if (res.ok) { DS[MONTHS[res.i]] = res.r.clients; ok++; }
    });
    if (!ok) throw new Error('All month fetches failed â€” check n8n is running and workflow is Active');
    mode = 'live';
    setCpill('live', 'LIVE Â· ' + ok + '/6');
    document.getElementById('src-lbl').textContent = 'n8n Webhook Â· ' + url + ' Â· ' + ok + '/6 months loaded';
    document.getElementById('foot-src').textContent = 'Live data from n8n';
    document.getElementById('foot-src').style.color = 'var(--grn)';
    startTimer(); hideLoad(); rebuildPills(); applyF(); showToast();
  }).catch(function(e) {
    hideLoad(); setCpill('err', 'FAILED');
    showTbox('âŒ ' + e.message + '\n\nCheck:\n1. docker start n8n\n2. ngrok http 5678 (running)\n3. Workflow is Active in n8n\n4. URL is correct', true);
    document.getElementById('drawer').classList.add('open');
  });
}

function testConn() {
  var url = document.getElementById('cfg-url').value.trim().replace(/\/$/, '');
  if (!url) { showTbox('âš  Enter a URL first.', true); return; }
  showTbox('ğŸ”„ Testing connectionâ€¦', false);
  fetch(url + '/webhook/scf-risk?month=SCF_Jan26', {
    headers: { 'ngrok-skip-browser-warning': 'true' }
  }).then(function(r) {
    if (!r.ok) throw new Error('HTTP ' + r.status);
    return r.json();
  }).then(function(d) {
    showTbox('âœ… Connected!\nClients: ' + (d.clients ? d.clients.length : '?') +
      '\nMonth: ' + (d.meta ? d.meta.month : '?') +
      '\nHigh: ' + (d.summary ? d.summary.high_risk : '?') +
      ' Â· Med: ' + (d.summary ? d.summary.medium_risk : '?') +
      ' Â· Low: ' + (d.summary ? d.summary.low_risk : '?'), false);
  }).catch(function(e) { showTbox('âŒ ' + e.message, true); });
}

function liveRefresh() {
  if (mode !== 'live' || !wUrl) return;
  var idx = MONTHS.indexOf(activeM);
  fetchMonth(MKEYS[idx], activeM).then(function(r) {
    DS[activeM] = r.clients;
    document.getElementById('last-txt').textContent = new Date().toLocaleTimeString('en-IN');
    applyF();
  }).catch(function(e) { console.warn('Refresh failed:', e.message); });
}

function useDemo() {
  DS = JSON.parse(JSON.stringify(DEMO)); mode = 'demo';
  setCpill('demo', 'DEMO MODE');
  document.getElementById('src-lbl').textContent = 'Demo Data Â· Aug 2025 â€“ Jan 2026';
  document.getElementById('foot-src').textContent = 'Demo mode';
  document.getElementById('foot-src').style.color = 'var(--amb)';
  if (refTimer) clearInterval(refTimer);
  document.getElementById('drawer').classList.remove('open');
  rebuildPills(); applyF();
}

function manualRefresh() {
  if (mode === 'live') liveRefresh(); else applyF();
  document.getElementById('last-txt').textContent = new Date().toLocaleTimeString('en-IN');
}

function startTimer() {
  if (refTimer) clearInterval(refTimer);
  if (!refMs) return;
  refCd = refMs / 1000;
  refTimer = setInterval(function() {
    refCd--;
    var m = Math.floor(refCd/60), s = refCd % 60;
    var t = m + ':' + (s < 10 ? '0' : '') + s;
    document.getElementById('rbcd').textContent = t;
    document.getElementById('ntxt').textContent = t;
    if (refCd <= 0) { refCd = refMs/1000; liveRefresh(); }
  }, 1000);
}

function showToast() {
  var b = document.getElementById('rbar'); b.classList.add('show');
  setTimeout(function() { b.classList.remove('show'); }, 4000);
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// RENDER
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function applyF() {
  var ind  = document.getElementById('sel-ind').value;
  var tier = document.getElementById('sel-tier').value;
  var q    = document.getElementById('srch').value.toLowerCase();
  var d    = DS[activeM] || [];
  filtered = d.filter(function(c) {
    return (!ind  || c.industry  === ind) &&
           (!tier || c.risk_tier === tier) &&
           (!q    || c.company_name.toLowerCase().indexOf(q) >= 0 ||
                     c.client_id.toLowerCase().indexOf(q) >= 0);
  });
  filtered.sort(function(a, b) {
    var av = a[sortK], bv = b[sortK];
    if (sortAsc) return av > bv ? 1 : -1;
    return av < bv ? 1 : -1;
  });
  renderAll();
}

function renderAll() { rKPIs(); rTable(); rDonut(); rTopRisk(); rHealth(); rAlerts(); }

function sc(s) { return s >= 65 ? 'var(--red)' : s >= 35 ? 'var(--amb)' : 'var(--grn)'; }
function badge(t) {
  var c = t === 'HIGH' ? 'b-r' : t === 'MEDIUM' ? 'b-a' : 'b-g';
  var d = t === 'HIGH' ? 'var(--red)' : t === 'MEDIUM' ? 'var(--amb)' : 'var(--grn)';
  return '<span class="badge ' + c + '"><span class="dot" style="background:' + d + '; box-shadow: 0 0 6px '+d+'"></span>' + t + '</span>';
}

function rKPIs() {
  var d  = DS[activeM] || [];
  var hi = d.filter(function(c){return c.risk_tier==='HIGH';}).length;
  var me = d.filter(function(c){return c.risk_tier==='MEDIUM';}).length;
  var lo = d.filter(function(c){return c.risk_tier==='LOW';}).length;
  var av = d.length ? Math.round(d.reduce(function(s,c){return s+c.risk_score;},0)/d.length) : 0;
  var ex = d.reduce(function(s,c){return s+(c.exposure_cr||0);},0).toFixed(1);
  var dp = d.length ? Math.round(d.reduce(function(s,c){return s+c.dpd;},0)/d.length) : 0;
  var items = [
    {c:'r',lbl:'HIGH RISK',val:hi,sub:'needs action',col:'var(--red)'},
    {c:'a',lbl:'MEDIUM RISK',val:me,sub:'monitor closely',col:'var(--amb)'},
    {c:'g',lbl:'LOW RISK',val:lo,sub:'healthy accounts',col:'var(--grn)'},
    {c:'b',lbl:'AVG SCORE',val:av,sub:'portfolio composite',col:'var(--blu)'},
    {c:'v',lbl:'EXPOSURE',val:'â‚¹'+ex+'Cr',sub:'total disbursed',col:'#818cf8'},
    {c:'c',lbl:'AVG DPD',val:dp,sub:'days past due',col:'#22d3ee'}
  ];
  var grad = {r:'linear-gradient(90deg,var(--red),#fca5a5)',a:'linear-gradient(90deg,var(--amb),#fde047)',g:'linear-gradient(90deg,var(--grn),#6ee7b7)',b:'linear-gradient(90deg,var(--blu),#93c5fd)',v:'linear-gradient(90deg,#818cf8,#c4b5fd)',c:'linear-gradient(90deg,#22d3ee,#67e8f9)'};
  document.getElementById('krow').innerHTML = items.map(function(k) {
    return '<div class="kcard">' +
      '<div class="kt" style="background:' + grad[k.c] + '"></div>' +
      '<div class="klbl">' + k.lbl + '</div>' +
      '<div class="kval" style="color:' + k.col + '">' + k.val + '</div>' +
      '<div class="ksub">' + k.sub + '</div></div>';
  }).join('');
}

function rTable() {
  document.getElementById('tbl-cnt').textContent = filtered.length + ' clients';
  var rows = filtered.map(function(c) {
    var dpdColor   = c.dpd > 30 ? 'var(--red)' : c.dpd > 10 ? 'var(--amb)' : 'var(--grn)';
    var utilColor  = c.utilization > 80 ? 'var(--red)' : c.utilization > 60 ? 'var(--amb)' : 'var(--grn)';
    var ovdColor   = c.overdue_pct > 30 ? 'var(--red)' : c.overdue_pct > 10 ? 'var(--amb)' : 'var(--grn)';
    var scoreBar   = '<div class="sw"><span class="sv" style="color:'+sc(c.risk_score)+'">'+c.risk_score+'</span><div class="sb"><div class="sbf" style="width:'+c.risk_score+'%;background:'+sc(c.risk_score)+'; box-shadow: 0 0 8px '+sc(c.risk_score)+'66"></div></div></div>';
    var id         = c.client_id.replace(/'/g, "\\'");
    return '<tr onclick="openM(\'' + id + '\')">' +
      '<td class="idc">' + c.client_id + '</td>' +
      '<td class="nc">' + c.company_name + '</td>' +
      '<td><span class="itag">' + c.industry + '</span></td>' +
      '<td>' + scoreBar + '</td>' +
      '<td>' + badge(c.risk_tier) + '</td>' +
      '<td class="mf" style="color:' + dpdColor + ';font-weight:700">' + c.dpd + '</td>' +
      '<td class="mf" style="color:' + utilColor + '">' + c.utilization + '%</td>' +
      '<td class="mf">' + c.dso + '</td>' +
      '<td class="mf" style="color:' + ovdColor + '">' + c.overdue_pct + '%</td>' +
      '<td class="mf" style="font-weight:700;color:var(--tx)">â‚¹' + c.exposure_cr + 'Cr</td>' +
      '<td><button class="nbtn btn-ghost" style="padding:6px 12px;font-size:12px" onclick="event.stopPropagation();openM(\'' + id + '\')">â†’</button></td>' +
      '</tr>';
  });
  document.getElementById('tbody').innerHTML = rows.join('');
}

function rDonut() {
  var d   = DS[activeM] || [];
  var cnt = {HIGH:0, MEDIUM:0, LOW:0};
  d.forEach(function(c) { cnt[c.risk_tier]++; });
  var tot  = d.length || 1;
  var clr  = {HIGH:'#f87171', MEDIUM:'#fbbf24', LOW:'#34d399'};
  var cx=80, cy=80, r=64, sw=16;
  var deg  = 0;
  var paths = '';
  Object.keys(cnt).forEach(function(t) {
    var n = cnt[t]; if (!n) return;
    var ang = (n/tot)*360;
    var r1 = deg * Math.PI/180;
    var r2 = (deg + ang - 0.5) * Math.PI/180;
    var x1 = cx + r*Math.cos(r1), y1 = cy + r*Math.sin(r1);
    var x2 = cx + r*Math.cos(r2), y2 = cy + r*Math.sin(r2);
    var lg = ang > 180 ? 1 : 0;
    paths += '<path d="M'+x1+','+y1+'A'+r+','+r+',0,'+lg+',1,'+x2+','+y2+'" fill="none" stroke="'+clr[t]+'" stroke-width="'+sw+'" stroke-linecap="round"/>';
    deg += ang;
  });
  document.getElementById('dsvg').innerHTML = paths;
  document.getElementById('dnum').textContent = d.length;
  document.getElementById('dleg').innerHTML = Object.keys(cnt).map(function(t) {
    var n = cnt[t];
    return '<div class="dlr"><div class="dll"><div class="dlc" style="background:'+clr[t]+'; box-shadow: 0 0 6px '+clr[t]+'88"></div><span style="font-size:13px; font-weight:600; color:var(--tm)">'+t+'</span></div>' +
      '<span class="dlv" style="color:'+clr[t]+'">'+n+' <span style="color:var(--td);font-weight:500">('+Math.round(n/tot*100)+'%)</span></span></div>';
  }).join('');
}

function rTopRisk() {
  var top = (DS[activeM]||[]).slice().sort(function(a,b){return b.risk_score-a.risk_score;}).slice(0,5);
  document.getElementById('top-list').innerHTML = top.map(function(c, i) {
    var id = c.client_id.replace(/'/g, "\\'");
    return '<div class="tri" onclick="openM(\'' + id + '\')">' +
      '<div class="trk" style="background:'+sc(c.risk_score)+'15;color:'+sc(c.risk_score)+'; border: 1px solid '+sc(c.risk_score)+'33">'+(i+1)+'</div>' +
      '<div class="tri-info"><div class="tri-nm">'+c.company_name+'</div>' +
      '<div class="tri-mt">'+c.client_id+' Â· '+c.industry+'</div></div>' +
      '<div class="tri-rt"><div class="tri-sc" style="color:'+sc(c.risk_score)+'">'+c.risk_score+'</div>' +
      '<div class="tri-ex">â‚¹'+c.exposure_cr+'Cr</div></div></div>';
  }).join('');
}

function rHealth() {
  var d = DS[activeM] || []; if (!d.length) return;
  var avgU = Math.round(d.reduce(function(s,c){return s+c.utilization;},0)/d.length);
  var avgD = Math.round(d.reduce(function(s,c){return s+c.dso;},0)/d.length);
  var npa  = d.filter(function(c){return c.dpd>90;}).length;
  var hi   = d.filter(function(c){return c.risk_tier==='HIGH';}).length;
  var br   = d.filter(function(c){return c.credit_breach>0;}).length;
  var bars = [
    ['Avg Utilization', avgU+'%', 'var(--blu)', avgU],
    ['Avg DSO', avgD+' days', '#818cf8', Math.min(avgD/120*100,100)],
    ['NPA (DPD>90)', npa+' clients', 'var(--red)', Math.min(npa/10*100,100)],
    ['High Risk Clients', hi+' of 50', 'var(--amb)', hi/d.length*100],
    ['Limit Breaches', br+' clients', 'var(--grn)', Math.min(br/50*100,100)]
  ];
  document.getElementById('h-area').innerHTML = bars.map(function(b) {
    return '<div><div class="hbl"><span class="hbn">'+b[0]+'</span>' +
      '<span class="hbv" style="color:'+b[2]+'">'+b[1]+'</span></div>' +
      '<div class="hbt"><div class="hbf" style="width:'+b[3]+'%;background:'+b[2]+'; box-shadow: 0 0 8px '+b[2]+'66"></div></div></div>';
  }).join('');
}

function rAlerts() {
  var d = DS[activeM] || [];
  var items = [];
  d.filter(function(c){return c.risk_tier==='HIGH';}).sort(function(a,b){return b.risk_score-a.risk_score;}).slice(0,5)
   .forEach(function(c){items.push({ico:'ğŸ”´',msg:'<strong>'+c.company_name+'</strong> â€” Score '+c.risk_score+', DPD '+c.dpd+'d, â‚¹'+c.exposure_cr+'Cr',t:'HIGH RISK'});});
  d.filter(function(c){return c.credit_breach>1;}).slice(0,3)
   .forEach(function(c){items.push({ico:'âš ï¸',msg:'<strong>'+c.company_name+'</strong> â€” Limit breached '+c.credit_breach+'Ã—, utilization '+c.utilization+'%',t:'BREACH'});});
  d.filter(function(c){return c.dpd>45&&c.risk_tier!=='HIGH';}).slice(0,2)
   .forEach(function(c){items.push({ico:'ğŸŸ¡',msg:'<strong>'+c.company_name+'</strong> â€” DPD '+c.dpd+'d, approaching HIGH threshold',t:'WATCH'});});
  document.getElementById('alist').innerHTML = items.length ? items.map(function(a) {
    return '<div class="ali"><div style="font-size:16px;flex-shrink:0;margin-top:2px">'+a.ico+'</div>' +
      '<div><div class="ali-msg">'+a.msg+'</div><div class="ali-t">'+a.t+' Â· '+activeM+'</div></div></div>';
  }).join('') : '<div style="padding:24px;text-align:center;color:var(--td);font-family:var(--fm);font-size:13px; font-weight:500;">âœ… No critical alerts for '+activeM+'</div>';
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// TREND CHART
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function drawTrend() {
  var cv  = document.getElementById('tcanvas');
  var CW  = (cv.parentElement.offsetWidth - 48) || 580;
  var CH  = 300;
  cv.width = CW; cv.height = CH;
  var ctx = cv.getContext('2d');
  ctx.clearRect(0,0,CW,CH);
  var pd  = {t:24, r:20, b:44, l:46};
  var cw  = CW - pd.l - pd.r;
  var ch  = CH - pd.t - pd.b;
  var avail = MONTHS.filter(function(m){return DS[m]&&DS[m].length;});
  var md  = avail.map(function(m){
    return {m:m,
      hi:DS[m].filter(function(c){return c.risk_tier==='HIGH';}).length,
      me:DS[m].filter(function(c){return c.risk_tier==='MEDIUM';}).length,
      lo:DS[m].filter(function(c){return c.risk_tier==='LOW';}).length};
  });
  if (md.length < 2) return;
  var max = 50;
  // grid lines
  ctx.strokeStyle = 'rgba(255,255,255,.05)'; ctx.lineWidth = 1;
  for (var i=0; i<=5; i++) {
    var y = pd.t + ch - (i/5)*ch;
    ctx.beginPath(); ctx.moveTo(pd.l, y); ctx.lineTo(CW-pd.r, y); ctx.stroke();
    ctx.fillStyle = '#71717a'; ctx.font = '11px JetBrains Mono';
    ctx.textAlign = 'right'; ctx.fillText(Math.round(i/5*max), pd.l-8, y+4);
  }
  // lines
  var series = [{c:'#f87171',k:'hi'},{c:'#fbbf24',k:'me'},{c:'#34d399',k:'lo'}];
  series.forEach(function(s) {
    ctx.beginPath(); ctx.strokeStyle = s.c; ctx.lineWidth = 3; ctx.lineJoin = 'round';
    md.forEach(function(d,i) {
      var x = pd.l + (i/(md.length-1))*cw;
      var y = pd.t + ch - (d[s.k]/max)*ch;
      i === 0 ? ctx.moveTo(x,y) : ctx.lineTo(x,y);
    });
    ctx.stroke();
    md.forEach(function(d,i) {
      var x = pd.l + (i/(md.length-1))*cw;
      var y = pd.t + ch - (d[s.k]/max)*ch;
      ctx.beginPath(); ctx.arc(x,y,5,0,Math.PI*2);
      ctx.fillStyle = s.c; ctx.shadowColor = s.c; ctx.shadowBlur = 10; ctx.fill(); ctx.shadowBlur = 0;
    });
  });
  // active month marker
  var ai = avail.indexOf(activeM);
  if (ai >= 0 && md.length > 1) {
    var ax = pd.l + (ai/(md.length-1))*cw;
    ctx.strokeStyle = 'rgba(234,179,8,.5)'; ctx.lineWidth = 1.5; ctx.setLineDash([5,4]);
    ctx.beginPath(); ctx.moveTo(ax, pd.t); ctx.lineTo(ax, pd.t+ch); ctx.stroke(); ctx.setLineDash([]);
  }
  // x-axis labels
  md.forEach(function(d,i) {
    var x = pd.l + (i/(md.length-1))*cw;
    ctx.fillStyle = d.m === activeM ? 'var(--gold)' : '#a1a1aa';
    ctx.font = (d.m===activeM ? '600 ' : '400 ') + '12px JetBrains Mono';
    ctx.textAlign = 'center'; ctx.fillText(d.m, x, CH-14);
  });
  // legend
  series.forEach(function(s,ki) {
    var lx = pd.l + ki*120;
    ctx.beginPath(); ctx.arc(lx+6, 14, 5, 0, Math.PI*2);
    ctx.fillStyle = s.c; ctx.shadowColor = s.c; ctx.shadowBlur = 8; ctx.fill(); ctx.shadowBlur = 0;
    ctx.fillStyle = '#a1a1aa'; ctx.font = '12px JetBrains Mono'; ctx.textAlign = 'left';
    ctx.fillText(['HIGH','MEDIUM','LOW'][ki]+' Risk', lx+16, 18);
  });
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// MODAL
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function openM(id) {
  var c = null;
  var d = DS[activeM] || [];
  for (var i=0; i<d.length; i++) { if (d[i].client_id === id) { c = d[i]; break; } }
  if (!c) return;

  var hist = MONTHS.filter(function(m){return DS[m];}).map(function(m) {
    var found = null;
    var dm = DS[m] || [];
    for (var i=0; i<dm.length; i++) { if (dm[i].client_id === id) { found = dm[i]; break; } }
    return found ? {m:m, s:found.risk_score, t:found.risk_tier} : null;
  }).filter(function(x){return x!==null;});

  var f = c.factors || scoreLocal(c).factors;

  var titleHTML = c.company_name + ' &nbsp;' + badge(c.risk_tier) +
    '<span style="font-family:var(--fm);font-size:13px;color:var(--tm);margin-left:14px; font-weight: 500;">' + c.client_id + ' Â· ' + c.state + '</span>';
  document.getElementById('m-title').innerHTML = titleHTML;

  var kpis = [
    {l:'RISK SCORE', v:c.risk_score+'<span style="font-size:14px;color:var(--td)">/100</span>', col:sc(c.risk_score)},
    {l:'EXPOSURE',   v:'â‚¹'+c.exposure_cr+'Cr', col:'var(--tx)'},
    {l:'DPD',        v:c.dpd+' days', col:c.dpd>30?'var(--red)':'var(--grn)'},
    {l:'UTILIZATION',v:c.utilization+'%', col:c.utilization>80?'var(--red)':'var(--grn)'},
    {l:'DSO / DPO',  v:c.dso+' / '+c.dpo, col:'var(--tx)'},
    {l:'OVERDUE %',  v:c.overdue_pct+'%', col:c.overdue_pct>30?'var(--red)':'var(--grn)'},
    {l:'CURRENT RATIO', v:c.current_ratio, col:c.current_ratio<1?'var(--red)':'var(--grn)'},
    {l:'DEBT/EQUITY', v:c.debt_equity, col:c.debt_equity>1.5?'var(--red)':'var(--grn)'},
    {l:'PAYMENT SCORE', v:c.payment_score+'<span style="font-size:14px;color:var(--td)">/100</span>', col:'var(--gold)'}
  ];

  var factorRows = [
    {n:'Days Past Due', s:f.dpd,    w:30},
    {n:'Utilization Rate', s:f.util, w:20},
    {n:'DSO/DPO Ratio', s:f.dso,   w:20},
    {n:'Overdue %',  s:f.ovd,      w:15},
    {n:'Txn Frequency', s:f.txn,   w:10},
    {n:'Credit Breaches', s:f.breach, w:5}
  ];

  var rec = c.risk_tier === 'HIGH'
    ? 'ğŸš¨ <strong style="color:var(--red)">Immediate Escalation.</strong><br/>DPD ' + c.dpd + 'd, Util ' + c.utilization + '%, ' + c.credit_breach + ' breach(es). Escalate to credit committee within 48hrs. Freeze limit. Initiate repayment discussion.'
    : c.risk_tier === 'MEDIUM'
    ? 'ğŸ“‹ <strong style="color:var(--amb)">Enhanced Monitoring.</strong><br/>DSO ' + c.dso + 'd vs DPO ' + c.dpo + 'd â€” receivable pressure. Monthly review cadence. No limit enhancement until score &lt;35.'
    : 'âœ… <strong style="color:var(--grn)">Healthy Account.</strong><br/>Low DPD (' + c.dpd + 'd), controlled utilization (' + c.utilization + '%), payment score ' + c.payment_score + '/100. Eligible for limit enhancement review.';

  var histChips = hist.map(function(h) {
    var bg = h.t==='HIGH'?'var(--rg)':h.t==='MEDIUM'?'var(--ag)':'var(--gg)';
    return '<span class="hchip" style="background:'+bg+';color:'+sc(h.s)+'; border: 1px solid '+sc(h.s)+'44">'+h.m+': '+h.s+'</span>';
  });
  if(histChips.length === 0) histChips = ['<span class="hchip" style="color:var(--td)">No history available</span>'];

  document.getElementById('m-body').innerHTML =
    '<div class="mg">' + kpis.map(function(k){
      return '<div class="mbox"><div class="mbl">'+k.l+'</div><div class="mbv" style="color:'+k.col+'">'+k.v+'</div></div>';
    }).join('') + '</div>' +
    '<div class="msh">RISK FACTOR BREAKDOWN</div>' +
    factorRows.map(function(r) {
      return '<div class="frow"><span class="fn">'+r.n+'</span><span class="fw">wt:'+r.w+'%</span>' +
        '<div class="fbt"><div class="fbf" style="width:'+r.s+'%;background:'+sc(r.s)+'; box-shadow: 0 0 8px '+sc(r.s)+'66"></div></div>' +
        '<span class="fsc" style="color:'+sc(r.s)+'">'+r.s+'</span></div>';
    }).join('') +
    '<div class="msh">6-MONTH HISTORY</div>' +
    '<div class="hrow">' + histChips.join('') + '</div>' +
    '<div class="msh">ANALYST RECOMMENDATION</div>' +
    '<div class="abox">' + rec + '</div>' +
    (c.analyst_flag ? '<div style="background:var(--ag);border:1px solid rgba(251,191,36,.25);border-radius:12px;padding:16px 20px;margin-top:12px;font-size:13px;color:var(--amb)">âš‘ Analyst Flag: <strong style="color: var(--tx)">' + c.analyst_flag + '</strong></div>' : '') +
    '<div class="macts"><button class="btn b-g" onclick="closeM(null)">Close</button><button class="btn b-p" onclick="alert(\'Report queued!\')">Export Report</button></div>';

  document.getElementById('mv').classList.add('on');
}

function closeM(e) {
  if (!e || e.target === document.getElementById('mv')) {
    document.getElementById('mv').classList.remove('on');
  }
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// UI HELPERS
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function switchTab(btn, v) {
  document.querySelectorAll('.tab').forEach(function(t){t.classList.remove('on');});
  btn.classList.add('on');
  document.getElementById('v-tbl').style.display    = v==='tbl'    ? 'block' : 'none';
  document.getElementById('v-trend').style.display  = v==='trend'  ? 'block' : 'none';
  document.getElementById('v-alerts').style.display = v==='alerts' ? 'block' : 'none';
  if (v === 'trend') setTimeout(drawTrend, 60);
}

function srt(k) {
  if (sortK === k) sortAsc = !sortAsc; else { sortK = k; sortAsc = false; }
  applyF();
}

function rebuildPills() {
  document.getElementById('mpills').innerHTML = MONTHS.filter(function(m){return DS[m];}).map(function(m) {
    return '<button class="mpill' + (m===activeM?' on':'') + '" onclick="setM(\'' + m + '\')">' + m + '</button>';
  }).join('');
}

function setM(m) { activeM = m; rebuildPills(); applyF(); }
function toggleDrawer() { document.getElementById('drawer').classList.toggle('open'); }
function setCpill(s, t) { document.getElementById('cpill').className='cpill '+s; document.getElementById('cpill-txt').textContent=t; }
function showLoad(m) { document.getElementById('ltxt').textContent=m; document.getElementById('lveil').classList.add('on'); }
function hideLoad() { document.getElementById('lveil').classList.remove('on'); }
function showTbox(m, err) { var el=document.getElementById('tbox'); el.textContent=m; el.className='tbox show'+(err?' fail':''); }

// clock
setInterval(function() {
  document.getElementById('clk').textContent = new Date().toLocaleTimeString('en-IN', {timeZone:'Asia/Kolkata'});
}, 1000);

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// BOOT SEQUENCE
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
if (document.getElementById('cfg-url').value.trim() !== '') {
  connectWebhook();
} else {
  rebuildPills();
  applyF();
}
</script>
</body>
</html>
